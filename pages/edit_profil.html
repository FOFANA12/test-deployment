<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modifier le Profil - Budget App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="../Pages/style.css" />

</head>

<body>
    <div class="container-fluid bg-white mb-2 shadow-sm border-bottom">
        <div class="d-flex align-items-center p-3">
            <a href="rewards.html" class="text-dark text-decoration-none">
                <i class="bi bi-chevron-left fs-6"></i>
            </a>
            <h5 class="mb-0 fw-semibold flex-grow-1 text-center me-4">Informations de profil</h5>
        </div>
    </div>
    <div class="container-fluid p-3">
        <div class="text-center mb-4">
            <img src="../Assets/images/profil.jpg" alt="Profile" class="rounded-circle small-profile-img mb-2"
                width="100" height="100">
            <a href="#" class="d-block text-primary"><i class="bi bi-camera me-1"></i> Changer la photo</a>
        </div>

        <form id="profileForm">
            <div class="mb-3">
                <label for="fullName" class="form-label">Nom complet</label>
                <input type="text" class="form-control" id="fullName" value="Themesflat Dupont">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" value="themesflat@budgetapp.com">
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Numéro de téléphone</label>
                <input type="tel" class="form-control" id="phone" value="+33 6 12 34 56 78">
            </div>
            <div class="mb-3">
                <label for="address" class="form-label">Adresse</label>
                <input type="text" class="form-control" id="address" value="12 Rue de la Finance">
            </div>
            <div class="mb-3">
                <label for="postcode" class="form-label">Code postal</label>
                <input type="text" inputmode="numeric" class="form-control" id="postcode" value="44000">
            </div>
            <div class="mb-3">
                <label for="ville" class="form-label">Ville</label>
                <input type="text" class="form-control" id="ville" value="Nantes">
            </div>

            <button type="submit" id="btnUpdate" class="btn btn-primary w-100 btn-lg mt-4">Sauvegarder les
                changements</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const btnUpdate = document.querySelector('#btnUpdate');

            if (btnUpdate) {
                btnUpdate.addEventListener('click', async (e) => {
                    e.preventDefault();

                    // Récupération des éléments
                    const fullName = document.getElementById("fullName").value;
                    const email = document.getElementById("email").value;
                    const phone = document.getElementById("phone").value;
                    const address = document.getElementById("address").value;
                    const postcode = document.getElementById("postcode").value;
                    const ville = document.getElementById("ville").value;
                    const userId = localStorage.getItem("user_id");

                    if (!userId) {
                        alert("Erreur : Utilisateur non connecté.");
                        return;
                    }

                    const formData = new FormData();
                    formData.append('fullName', fullName);
                    formData.append('email', email);
                    formData.append('phone', phone);
                    formData.append('address', address);
                    formData.append('postcode', postcode);
                    formData.append('ville', ville);
                    formData.append('user_id', userId);

                    try {
                        const response = await fetch("../backend/update_profile.php", {
                            method: "POST",
                            body: formData
                        });

                        // Vérifie si la réponse est bien du JSON
                        const result = await response.json();

                        if (result.status === "success") {
                            alert("Profil mis à jour !");
                        } else {
                            alert("Erreur : " + result.message);
                        }
                    } catch (error) {
                        console.error("Erreur technique :", error);
                        alert("Impossible de contacter le serveur.");
                    }
                });
            }
        });
    </script>
</body>

</html>